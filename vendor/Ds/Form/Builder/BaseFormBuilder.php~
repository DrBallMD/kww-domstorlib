<?php
namespace Estate\Search\Form\Builder;

/**
 * Description of BaseFormBuilder
 *
 * @author pahhan
 */
abstract class BaseFormBuilder
{
    /**
     * Build form
     * @param integer $ref_id Reference city id
     * @param string $action Estate action (sale, rent, purchase, etc.)
     * @param boolean $in_region Define whether form is for region or not (some difference in fields)
     * @return Estate\Search\Form\BaseForm
     */
    abstract public function build($ref_city_id, $action, $in_region);
    abstract protected function buildSale();
    abstract protected function buildRent();
    abstract protected function buildPurchase();
    abstract protected function buildRentuse();

    /**
     *
     * @param string $action
     * @return \Estate\Search\Form\BaseForm
     * @throws \Exception If action is undefined
     */
    protected function createForm($action)
    {
        if( $action === 'sale' )
            $form = $this->buildSale();
        elseif( $action === 'rent' )
            $form = $this->buildRent();
        elseif( $action === 'purchase' )
            $form = $this->buildPurchase();
        elseif( $action === 'rentuse' )
            $form = $this->buildRentuse();
        else
            throw new \Exception(sprintf('Unknown action "%s"', $action));

        return $form;
    }

    /**
     *
     * @param integer $ref_city_id
     * @param boolean $in_region
     * @return \Spv_Form_Form
     */
    protected function createLocationField($ref_city_id, $in_region)
    {
        if( $in_region )
        {
            $field = new \Estate\Search\Form\Field\CityField();
            $field->setOptions(\Address1Table::getInstance()->getForSearch($ref_city_id));
        }
        else
        {
            $field = new \Estate\Search\Form\Field\DistrictField();
            $field->setOptions(\Address2Table::getInstance()->getDistricts($ref_city_id));
        }
        return $field;
    }

    /**
     * Adds code and exposition fields which are common for all search forms
     * @param \Estate\Search\Form\BaseForm $form
     * @param string $action Defines code label
     */
    protected function addCodeExpositionFields(\Estate\Search\Form\BaseForm $form, $action)
    {
        $form->addForm(new \Spv_Form_Field_InputText('code', array(
            'templating_key' => 'twig_form',
            'template' => '@spv/input_text.html.twig',
            'label' => ( $action == 'purchase' or $action == 'rentuse' )? 'Код заявки:' : 'Код объекта:',
        )));

        $form->addForm(new \Spv_Form_Field_InputText('expo', array(
            'templating_key' => 'twig_form',
            'template' => 'fields/expo.html.twig',
            'label' => 'Обновления за',
        )));
    }
}

